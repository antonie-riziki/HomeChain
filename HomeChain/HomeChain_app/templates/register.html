<!DOCTYPE html>

<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>HomeChain - Create Account</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1193d4",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                    },
                    fontFamily: {
                        "display": ["Lexend"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-800 dark:text-slate-100 min-h-screen flex items-center justify-center p-6 antialiased">
<div class="w-full max-w-md">
<!-- Back to Home Button -->
<div class="mb-6">
<a href="/" class="inline-flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 hover:text-primary transition-colors">
<span class="material-icons-round text-lg">home</span>
Back to Home
</a>
</div>
<!-- Progress & Header -->
<div class="mb-8">
<div class="flex items-center justify-between mb-8">
<div class="flex gap-1.5">
<div id="step1-indicator" class="h-1.5 w-12 rounded-full bg-primary"></div>
<div id="step2-indicator" class="h-1.5 w-12 rounded-full bg-primary/20 dark:bg-primary/10"></div>
<div id="step3-indicator" class="h-1.5 w-12 rounded-full bg-primary/20 dark:bg-primary/10"></div>
</div>
<span id="step-text" class="text-xs font-medium text-primary/60 tracking-wider uppercase">Step 1 of 3</span>
</div>
<h1 id="step-title" class="text-3xl font-bold text-slate-900 dark:text-white mb-2 leading-tight">Create your account</h1>
<p id="step-description" class="text-slate-500 dark:text-slate-400">Join HomeChain and get started today.</p>
</div>

<!-- Error Message -->
<div id="errorMessage" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg text-sm mb-6">
</div>

<!-- Step 1: Account Basics -->
<form id="step1" class="space-y-5">
<div>
<label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Email Address</label>
<div class="relative">
<span class="absolute left-4 top-1/2 -translate-y-1/2 material-icons-round text-slate-400 text-xl">email</span>
<input
                        type="email"
                        id="email"
                        required
                        class="w-full pl-12 pr-4 py-3.5 bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                        placeholder="you@example.com"
                    />
</div>
</div>

<div>
<label for="password" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Password</label>
<div class="relative">
<span class="absolute left-4 top-1/2 -translate-y-1/2 material-icons-round text-slate-400 text-xl">lock</span>
<input
                        type="password"
                        id="password"
                        required
                        class="w-full pl-12 pr-12 py-3.5 bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                        placeholder="••••••••"
                    />
<button type="button" onclick="togglePassword('password')" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">
<span class="material-icons-round text-xl">visibility_off</span>
</button>
</div>
<p class="text-xs text-slate-500 mt-1">Minimum 8 characters</p>
</div>

<div>
<label for="full_name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Full Name</label>
<div class="relative">
<span class="absolute left-4 top-1/2 -translate-y-1/2 material-icons-round text-slate-400 text-xl">person</span>
<input
                        type="text"
                        id="full_name"
                        required
                        class="w-full pl-12 pr-4 py-3.5 bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                        placeholder="John Doe"
                    />
</div>
</div>

<button
                type="button"
                onclick="nextStep(1)"
                class="w-full bg-primary hover:bg-primary/90 text-white font-semibold py-4 rounded-xl shadow-lg shadow-primary/30 transition-all flex items-center justify-center gap-2 group"
            >
<span>Continue</span>
<span class="material-icons-round text-xl group-hover:translate-x-1 transition-transform">arrow_forward</span>
</button>
</form>

<!-- Step 2: User Type & Details -->
<form id="step2" class="space-y-5 hidden">
<input type="hidden" id="user_type" value=""/>

<div>
<label for="phone_number" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Phone Number</label>
<div class="relative">
<span class="absolute left-4 top-1/2 -translate-y-1/2 material-icons-round text-slate-400 text-xl">phone</span>
<input
                        type="tel"
                        id="phone_number"
                        class="w-full pl-12 pr-4 py-3.5 bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                        placeholder="+1 (555) 000-0000"
                    />
</div>
</div>

<div>
<label for="location" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Location</label>
<div class="relative">
<span class="absolute left-4 top-1/2 -translate-y-1/2 material-icons-round text-slate-400 text-xl">location_on</span>
<input
                        type="text"
                        id="location"
                        required
                        class="w-full pl-12 pr-4 py-3.5 bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                        placeholder="City, State"
                    />
</div>
</div>

<div>
<label for="bio" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Bio (Optional)</label>
<textarea
                    id="bio"
                    rows="4"
                    class="w-full px-4 py-3.5 bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none"
                    placeholder="Tell us about yourself..."
                ></textarea>
</div>

<div class="flex gap-3">
<button
                    type="button"
                    onclick="previousStep(2)"
                    class="flex-1 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-semibold py-4 rounded-xl transition-all hover:bg-slate-200 dark:hover:bg-slate-700"
                >
                    Back
                </button>
<button
                    type="button"
                    onclick="nextStep(2)"
                    class="flex-1 bg-primary hover:bg-primary/90 text-white font-semibold py-4 rounded-xl shadow-lg shadow-primary/30 transition-all flex items-center justify-center gap-2 group"
                >
<span>Continue</span>
<span class="material-icons-round text-xl group-hover:translate-x-1 transition-transform">arrow_forward</span>
</button>
</div>
</form>

<!-- Step 3: Confirmation -->
<form id="step3" class="space-y-5 hidden">
<div class="bg-white dark:bg-slate-800/50 rounded-xl p-5 border border-slate-200 dark:border-slate-700 space-y-3">
<div class="flex items-center gap-3 pb-3 border-b border-slate-100 dark:border-slate-700">
<div class="w-12 h-12 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center">
<span class="material-icons-round text-primary text-2xl" id="user-type-icon">person</span>
</div>
<div>
<p class="text-xs text-slate-500 dark:text-slate-400">Account Type</p>
<p class="font-semibold" id="user-type-display">Employer</p>
</div>
</div>
<div class="space-y-2 text-sm">
<div class="flex justify-between">
<span class="text-slate-500">Email:</span>
<span class="font-medium" id="confirm-email"></span>
</div>
<div class="flex justify-between">
<span class="text-slate-500">Name:</span>
<span class="font-medium" id="confirm-name"></span>
</div>
<div class="flex justify-between">
<span class="text-slate-500">Location:</span>
<span class="font-medium" id="confirm-location"></span>
</div>
</div>
</div>

<div class="flex items-start gap-3 px-1">
<input 
                    class="mt-1 rounded text-primary focus:ring-primary border-slate-300 dark:bg-slate-800 dark:border-slate-700" 
                    id="terms" 
                    type="checkbox"
                    required
                />
<label class="text-xs text-slate-500 dark:text-slate-400 leading-tight" for="terms">
                    I agree to HomeChain's <a href="#" class="text-primary hover:underline">Terms of Service</a> and <a href="#" class="text-primary hover:underline">Privacy Policy</a>. I understand that payments are held in secure escrow.
                </label>
</div>

<div class="flex gap-3">
<button
                    type="button"
                    onclick="previousStep(3)"
                    class="flex-1 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-semibold py-4 rounded-xl transition-all hover:bg-slate-200 dark:hover:bg-slate-700"
                >
                    Back
                </button>
<button
                    type="submit"
                    id="submitBtn"
                    class="flex-1 bg-primary hover:bg-primary/90 text-white font-semibold py-4 rounded-xl shadow-lg shadow-primary/30 transition-all flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed"
                >
<span id="submitText">Create Account</span>
<span class="material-icons-round text-xl" id="submitIcon">check_circle</span>
</button>
</div>
</form>

<!-- Footer -->
<div class="mt-8 text-center">
<p class="text-sm text-slate-600 dark:text-slate-400">
                Already have an account? 
                <a href="/login/" class="text-primary hover:text-primary/80 font-medium transition-colors">Sign in</a>
</p>
</div>
</div>

<!-- Decorative Elements -->
<div class="fixed -top-24 -right-24 w-64 h-64 bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>
<div class="fixed -bottom-24 -left-24 w-64 h-64 bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>

<script>
        // Get user type from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const userTypeParam = urlParams.get('type');
        
        // Toggle password visibility
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = field.nextElementSibling.querySelector('.material-icons-round');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.textContent = 'visibility';
            } else {
                field.type = 'password';
                icon.textContent = 'visibility_off';
            }
        }

        // Update progress indicators
        function updateProgress(step) {
            const indicators = [
                document.getElementById('step1-indicator'),
                document.getElementById('step2-indicator'),
                document.getElementById('step3-indicator')
            ];
            
            indicators.forEach((indicator, index) => {
                if (index < step) {
                    indicator.className = 'h-1.5 w-12 rounded-full bg-primary';
                } else {
                    indicator.className = 'h-1.5 w-12 rounded-full bg-primary/20 dark:bg-primary/10';
                }
            });
            
            document.getElementById('step-text').textContent = `Step ${step} of 3`;
        }

        // Update step content
        function updateStepContent(step) {
            const titles = [
                'Create your account',
                'Tell us more',
                'Review & confirm'
            ];
            const descriptions = [
                'Join HomeChain and get started today.',
                'Help us personalize your experience.',
                'Verify your information before creating your account.'
            ];
            
            document.getElementById('step-title').textContent = titles[step - 1];
            document.getElementById('step-description').textContent = descriptions[step - 1];
        }

        // Show/hide steps
        function showStep(step) {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById(`step${step}`).classList.remove('hidden');
            
            updateProgress(step);
            updateStepContent(step);
            hideError();
        }

        // Navigation functions
        function nextStep(currentStep) {
            const errorMessage = document.getElementById('errorMessage');
            
            if (currentStep === 1) {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const fullName = document.getElementById('full_name').value;
                
                if (!email || !password || !fullName) {
                    showError('Please fill in all required fields.');
                    return;
                }
                
                if (password.length < 8) {
                    showError('Password must be at least 8 characters long.');
                    return;
                }
                
                // Set user type from URL or default to employer
                const userType = userTypeParam || 'employer';
                document.getElementById('user_type').value = userType;
                
                showStep(2);
            } else if (currentStep === 2) {
                const location = document.getElementById('location').value;
                
                if (!location) {
                    showError('Please enter your location.');
                    return;
                }
                
                // Populate confirmation
                document.getElementById('confirm-email').textContent = document.getElementById('email').value;
                document.getElementById('confirm-name').textContent = document.getElementById('full_name').value;
                document.getElementById('confirm-location').textContent = location;
                
                const userType = document.getElementById('user_type').value;
                document.getElementById('user-type-display').textContent = 
                    userType === 'worker' ? 'Worker' : 'Employer';
                document.getElementById('user-type-icon').textContent = 
                    userType === 'worker' ? 'engineering' : 'home_work';
                
                showStep(3);
            }
        }

        function previousStep(currentStep) {
            showStep(currentStep - 1);
        }

        // Error handling
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        // Form submission
        document.getElementById('step3').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitIcon = document.getElementById('submitIcon');
            
            if (!document.getElementById('terms').checked) {
                showError('You must agree to the Terms of Service to continue.');
                return;
            }
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitText.textContent = 'Creating account...';
            submitIcon.textContent = 'hourglass_empty';
            
            const formData = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                full_name: document.getElementById('full_name').value,
                user_type: document.getElementById('user_type').value.toUpperCase(),
                phone_number: document.getElementById('phone_number').value,
                location: document.getElementById('location').value,
                bio: document.getElementById('bio').value
            };
            
            try {
                const response = await fetch('/api/accounts/register/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Store tokens
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // Show success
                    submitText.textContent = 'Success!';
                    submitIcon.textContent = 'check_circle';
                    
                    // Redirect based on user type
                    setTimeout(() => {
                        if (data.user.user_type === 'EMPLOYER') {
                            window.location.href = '/employer-dashboard/';
                        } else if (data.user.user_type === 'WORKER') {
                            window.location.href = '/worker-dashboard/';
                        } else {
                            window.location.href = '/';
                        }
                    }, 500);
                } else {
                    // Show error message
                    const errorMsg = data.error || data.errors?.email?.[0] || 'Registration failed. Please try again.';
                    showError(errorMsg);
                    
                    // Re-enable button
                    submitBtn.disabled = false;
                    submitText.textContent = 'Create Account';
                    submitIcon.textContent = 'check_circle';
                }
            } catch (error) {
                console.error('Registration error:', error);
                showError('An error occurred. Please try again later.');
                
                // Re-enable button
                submitBtn.disabled = false;
                submitText.textContent = 'Create Account';
                submitIcon.textContent = 'check_circle';
            }
        });
    </script>
</body></html>
